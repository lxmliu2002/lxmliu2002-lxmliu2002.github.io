<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>PaperReading_Asm2Vec | lxmliu2002's blog</title><meta name="author" content="Xiuming Liu"><meta name="copyright" content="Xiuming Liu"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="PaperReading">
<meta property="og:type" content="article">
<meta property="og:title" content="PaperReading_Asm2Vec">
<meta property="og:url" content="http://example.com/2024/03/22/PaperReading_Asm2Vec/index.html">
<meta property="og:site_name" content="lxmliu2002&#39;s blog">
<meta property="og:description" content="PaperReading">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://github.com/lxmliu2002/images/raw/main/homepage/home-bg-03.jpg">
<meta property="article:published_time" content="2024-03-21T16:00:00.000Z">
<meta property="article:modified_time" content="2024-03-23T02:23:43.660Z">
<meta property="article:author" content="Xiuming Liu">
<meta property="article:tag" content="Binary-Code-Search">
<meta property="article:tag" content="Vulnerability-Search">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://github.com/lxmliu2002/images/raw/main/homepage/home-bg-03.jpg"><link rel="shortcut icon" href="https://github.com/lxmliu2002/images/raw/main/favicon.ico"><link rel="canonical" href="http://example.com/2024/03/22/PaperReading_Asm2Vec/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":1,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":200},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'PaperReading_Asm2Vec',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-03-23 10:23:43'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">
<link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/clock.min.css" /><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://github.com/lxmliu2002/images/raw/main/lxmliu2002.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">38</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">12</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">16</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> 文档</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image: url('https://github.com/lxmliu2002/images/raw/main/homepage/home-bg-03.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="lxmliu2002's blog"><span class="site-name">lxmliu2002's blog</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> 文档</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">PaperReading_Asm2Vec</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-03-21T16:00:00.000Z" title="发表于 2024-03-22 00:00:00">2024-03-22</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-03-23T02:23:43.660Z" title="更新于 2024-03-23 10:23:43">2024-03-23</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Binary-Code-Search/">Binary-Code-Search</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Vulnerability-Search/">Vulnerability-Search</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="PaperReading_Asm2Vec"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><ul>
<li><h1 id="Asm2Vec-Boosting-Static-Representation-Robustness-for-Binary-Clone-Search-against-Code-Obfuscation-and-Compiler-Optimization"><a href="#Asm2Vec-Boosting-Static-Representation-Robustness-for-Binary-Clone-Search-against-Code-Obfuscation-and-Compiler-Optimization" class="headerlink" title="Asm2Vec: Boosting Static Representation Robustness for Binary Clone Search against Code Obfuscation and Compiler Optimization"></a>Asm2Vec: Boosting Static Representation Robustness for Binary Clone Search against Code Obfuscation and Compiler Optimization</h1><h2 id="通读"><a href="#通读" class="headerlink" title="通读"></a>通读</h2><h3 id="Abstract"><a href="#Abstract" class="headerlink" title="Abstract"></a>Abstract</h3><p>汇编工程在分析中特别重要，汇编克隆引擎通过识别重复的或已知的部件来帮助工程师。由于各种编译优化选项和代码混淆技术，使得那些看上去相似的函数，实际上截然不同。</p>
<p>一个实用性的克隆搜索引擎依赖于将汇编代码 embedding 成一个鲁棒的向量，但现有的却依赖于人工定义的一些特征从汇编函数中提取特征向量，无法考虑特征之间的关系，无法有效分辨汇编函数是否相同。基于此，作者建议联合学习基于汇编代码的汇编函数的语义关系和向量表示，并开发出 Asm2Vec 模型。该模型只需要汇编代码输入，不需要任何先验知识，便可学习到丰富的语义知识。作者进行实验后得出结论，此模型在引入混淆和优化后优势更加明显。</p>
</li>
</ul>
<h3 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h3><p>  现有软件开发中，由于对源代码的多次重用，导致底层的汇编代码也存在大量克隆（重用）。一个高效的克隆搜索引擎能够显著减少逆向中手动分析的负担，通过海量的二进制数据解决信息需求。</p>
<p>  汇编代码克隆搜索已称为一种有助于解决安全相关问题的信息检索（IR）技术，被用于不同二进制文件来定位更改的部分，识别已知的二进制函数块，搜索现有软件或 IOT 固件设备中的已知的 bug 或 zero-day 漏洞和当源代码不可用时检测软件剽窃和 GNU 许可侵权。然而，由于不同的编译优化选项和混淆技术，使得逻辑上相似的汇编函数会有巨大差异，优化和混淆汇编函数打破了控制流和基本快的完整性，识别这些语义相似但是结构和语法不同的克隆代码非常困难，导致难于开发设计一个高效的搜索引擎。</p>
<p>  <img src="https://github.com/lxmliu2002/images/raw/main/post/20240322/image-20240322102427626.png" alt="image-20240322102427626" style="zoom: 33%;"></p>
<p>  如图，相同的源代码编译后得到不同的汇编函数。gcc O0，gcc O3，LLVM 混淆器控制流图扁平化，LLVM 混淆器 Bogus 控制流图，Asm2Vec 都能够静态地将其识别成克隆。</p>
<p>  开发克隆引擎解决方案需要对汇编代码进行鲁棒的向量表示，以此测量出查询和索引函数之间的相似性。基于人工设计的特征，相关研究可以分为静态方法和动态方法。动态方法通过动态分析汇编代码的 IO 行为来建模语义相似性。静态方法通过观察代码在语法或描述性的信息上的静态差异来进行相似性建模。静态方法更可拓展，覆盖率高于动态方法。动态方法对语法的变化更加鲁棒，但可扩展性差。作者确定了两个问题，以提高静态特征的语义丰富度和鲁棒性。通过这两个因素，静态方法甚至可以比最先进的动态方法获得更好的性能。</p>
<ol>
<li><p>现有的最先进的静态方法没有考虑到特征之间的关系。作者建议将词汇语义关系合并到特征工程过程中。作者提出，不需要先验知识，而直接从普通的汇编代码中学习潜在的关系。Asm2Vec 学习 token 之间潜在的此法语义关系，而不需要任何先验知识。</p>
<p><img src="https://github.com/lxmliu2002/images/raw/main/post/20240322/image-20240322104404754.png" alt="image-20240322104404754" style="zoom:33%;"></p>
</li>
<li><p>现有的静态方法的特征权重相同，或者需要一个等价的汇编函数的映射来学习权重。所选的权重可能不包含将一个汇编函数与另一个汇编函数区分开来的重要模式和多样性。经验丰富的逆向工程师并非通过平等地查看整个内容或逻辑来识别已知函数，而是根据经验确定是被特定函数的关键点和重要模式。作者提出，可以模拟经验丰富的逆向工程师的工作方式，训练一个神经网络模型来读取汇编代码数据，并让模型识别出一个将函数与其他函数区分开来的最佳表现。</p>
<p>本文有如下贡献：</p>
</li>
<li><p>提出一种新颖的汇编克隆检测方式，不需要人为定义特征，是第一个使用表示学习对汇编代码 embedding 的方法。</p>
</li>
<li><p>开发了一个表示学习模型 Asm2Vec，以汇编代码作为输入，学习 token 之间的潜在词汇语义，并将汇编函数表示为内部语义信息的加权混合，不需要任何先验知识。</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/402902793">深入理解人工智能——什么是表示学习？</a></p>
<p><strong>表示学习(representation learning)</strong>，又叫特征学习(feature learning)或者表征学习，一般指模型自动从数据中抽取特征或者表示的方法，是模型自动学习的过程</p>
<p>总结，特征自学习</p>
</blockquote>
</li>
<li><p>证明 Asm2Vec 比最先进的静态和动态模型更加适应代码混淆和编译器优化。在公开的漏洞数据集上进行漏洞搜索实验，实现了零误报和 100% 召回率，优于目前最先进的漏洞搜索模型。</p>
<p>但是，Asm2Vec 作为静态方法并不能完全消除代码混淆，但是比最先进的静态特征更加适应代码混淆。</p>
<h3 id="Problem-Definition"><a href="#Problem-Definition" class="headerlink" title="Problem Definition"></a>Problem Definition</h3><p>在汇编克隆搜索领域，有四种类型的克隆：字面相同、句法等价、轻微修改、语义相似。本文主要聚焦语义相似类型，即灰白你函数可能在句法上不同，但源代码具有相似的功能逻辑。</p>
<p>本文作如下概念定义：</p>
</li>
</ol>
<ul>
<li>function 表示汇编函数</li>
<li>source function 表示源函数</li>
<li>repository function 表示存储在库中的汇编函数</li>
<li><p>target function 表示要查询的汇编函数</p>
<p>本文目标是从存储库 RP 中搜索其语义克隆，问题定义为：给定一个要查询的目标汇编函数 <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.464ex;" xmlns="http://www.w3.org/2000/svg" width="1.874ex" height="2.059ex" role="img" focusable="false" viewBox="0 -705 828.3 910"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D453" d="M118 -162Q120 -162 124 -164T135 -167T147 -168Q160 -168 171 -155T187 -126Q197 -99 221 27T267 267T289 382V385H242Q195 385 192 387Q188 390 188 397L195 425Q197 430 203 430T250 431Q298 431 298 432Q298 434 307 482T319 540Q356 705 465 705Q502 703 526 683T550 630Q550 594 529 578T487 561Q443 561 443 603Q443 622 454 636T478 657L487 662Q471 668 457 668Q445 668 434 658T419 630Q412 601 403 552T387 469T380 433Q380 431 435 431Q480 431 487 430T498 424Q499 420 496 407T491 391Q489 386 482 386T428 385H372L349 263Q301 15 282 -47Q255 -132 212 -173Q175 -205 139 -205Q107 -205 81 -186T55 -132Q55 -95 76 -78T118 -61Q162 -61 162 -103Q162 -122 151 -136T127 -157L118 -162Z"></path></g><g data-mml-node="mi" transform="translate(523,-150) scale(0.707)"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g></g></g></g></svg></mjx-container>，搜索问题是检索得到 top-k 的 repository function (按语义相似性进行排序)，这 k 个函数可被看作语义相似克隆。</p>
<h3 id="Overall-Workflow"><a href="#Overall-Workflow" class="headerlink" title="Overall Workflow"></a>Overall Workflow</h3><p>如图是 Asm2Vec 的流程图。</p>
<p><img src="https://github.com/lxmliu2002/images/raw/main/post/20240322/image-20240322120549152.png" alt="image-20240322120549152" style="zoom:50%;"></p>
</li>
</ul>
<ol>
<li>给定一个汇编函数的存储库，为其构建一个神经网络模型进行训练</li>
<li>训练结束后，模型为每个汇编函数生成一个向量表示</li>
<li>给定一个要查询的函数（未用于训练），使用训练好的模型生成向量表示</li>
<li><p>比较查询函数与各个 repository function 向量表示之间的余弦相似度，选择 top-k 作为结果</p>
<p>如果将新的汇编函数添加到存储库中，遵循 step3 进行估计。该模型可以定期重新训练以保证生成质量。</p>
<h3 id="Assembly-Code-Representation-Learning"><a href="#Assembly-Code-Representation-Learning" class="headerlink" title="Assembly Code Representation Learning"></a>Assembly Code Representation Learning</h3><p>作者基于 PV-DM 模型进行设计。</p>
<h4 id="Preliminaries"><a href="#Preliminaries" class="headerlink" title="Preliminaries"></a>Preliminaries</h4><p>PV-DM 模型针对于文本数据进行设计，是 word2vec 模型的拓展。模型结构如图所示：</p>
<p><img src="https://github.com/lxmliu2002/images/raw/main/post/20240322/image-20240322201158062.png" alt="image-20240322201158062" style="zoom:50%;"></p>
<p>其在 CBOW 的基础上引入了 paragraph-ID。其将 paragraph-ID 和上下文的单词一起通过 embedding 矩阵得到对应的向量，然后通过 average 操作，最后经过 softmax 得到输出，输出与中心词对比，反向传播更新 embedding 矩阵。</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_45198339/article/details/128772164">CBOW</a> 是指连续词袋模型，每个词对应一个一维向量，初始化随机，通过梯度下降法进行更新。</p>
</blockquote>
<p>通过引入 paragraph-ID，由于 paragraph-ID 这个向量是整段的单词共享的，PV-DM 模型可以让一段(或一个主题)的单词都学习到部分主题信息。这样对于不同主题的单词的区分也就更加明显，embedding 的效果也自然优于传统的 CBOW 模型。</p>
<p>然而，汇编代码比纯文本有着更丰富的语法，包含着操作符，操作数，控制流等等复杂的结构。因此，作者提出了 Asm2Vec 模型来对汇编代码进行 embedding。</p>
<h4 id="The-Asm2Vec-Model"><a href="#The-Asm2Vec-Model" class="headerlink" title="The Asm2Vec Model"></a>The Asm2Vec Model</h4><p>汇编函数可以用控制流程图（CFG）来表示，本文将控制流程图建模为多个序列，每一个序列对应着一个包含线性排列的汇编指令的潜在执行路径。给定一个二进制文件，使用 IDA pro 反汇编提取汇编函数及其基本块和控制流程图列表。</p>
<p><img src="https://github.com/lxmliu2002/images/raw/main/post/20240322/image-20240322202411622.png" alt="image-20240322202411622" style="zoom:50%;"></p>
<p>因此将汇编函数转化为多个序列表示，对于每一个序列，从前往后扫描每一行汇编代码 A，将其前后的汇编代码（上下文）和一个代表该函数的向量（类比 paragraph-ID）一起，经过 average 和 concate 操作，最后经过 sigmoid 函数预测中心汇编代码 A。其中为 A 生成的汇编代码向量叫做 <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="1.444ex" height="1.742ex" role="img" focusable="false" viewBox="0 -759 638.5 770"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mi"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mo" transform="translate(394,363) scale(0.707)"><path data-c="2032" d="M79 43Q73 43 52 49T30 61Q30 68 85 293T146 528Q161 560 198 560Q218 560 240 545T262 501Q262 496 260 486Q259 479 173 263T84 45T79 43Z"></path></g></g></g></g></svg></mjx-container>，用来做 token 的预测，而训练过程中得到的汇编代码向量叫做 <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="0.817ex" height="1.441ex" role="img" focusable="false" viewBox="0 -626 361 637"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g></g></g></svg></mjx-container>，用于表示 token 的语义信息。</p>
<p>将 <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="0.817ex" height="1.441ex" role="img" focusable="false" viewBox="0 -626 361 637"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g></g></g></svg></mjx-container> 和 $\theta<em>{f_s}<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.452ex;" xmlns="http://www.w3.org/2000/svg" width="23.756ex" height="2.149ex" role="img" focusable="false" viewBox="0 -750 10500 950"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">初</text></g><g data-mml-node="mi" transform="translate(1000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">始</text></g><g data-mml-node="mi" transform="translate(2000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">化</text></g><g data-mml-node="mi" transform="translate(3000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">为</text></g><g data-mml-node="mn" transform="translate(4000,0)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g><g data-mml-node="mi" transform="translate(4500,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">附</text></g><g data-mml-node="mi" transform="translate(5500,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">近</text></g><g data-mml-node="mi" transform="translate(6500,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">的</text></g><g data-mml-node="mi" transform="translate(7500,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">小</text></g><g data-mml-node="mi" transform="translate(8500,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">值</text></g><g data-mml-node="mi" transform="translate(9500,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">，</text></g></g></g></svg></mjx-container>t’<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.464ex;" xmlns="http://www.w3.org/2000/svg" width="90.511ex" height="2.161ex" role="img" focusable="false" viewBox="0 -750 40006 955"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">初</text></g><g data-mml-node="mi" transform="translate(1000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">始</text></g><g data-mml-node="mi" transform="translate(2000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">化</text></g><g data-mml-node="mi" transform="translate(3000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">为</text></g><g data-mml-node="mn" transform="translate(4000,0)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g><g data-mml-node="mi" transform="translate(4500,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">进</text></g><g data-mml-node="mi" transform="translate(5500,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">行</text></g><g data-mml-node="mi" transform="translate(6500,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">训</text></g><g data-mml-node="mi" transform="translate(7500,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">练</text></g><g data-mml-node="mi" transform="translate(8500,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">，</text></g><g data-mml-node="mi" transform="translate(9500,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">训</text></g><g data-mml-node="mi" transform="translate(10500,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">练</text></g><g data-mml-node="mi" transform="translate(11500,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">结</text></g><g data-mml-node="mi" transform="translate(12500,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">束</text></g><g data-mml-node="mi" transform="translate(13500,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">后</text></g><g data-mml-node="mi" transform="translate(14500,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">，</text></g><g data-mml-node="mi" transform="translate(15500,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">就</text></g><g data-mml-node="mi" transform="translate(16500,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">可</text></g><g data-mml-node="mi" transform="translate(17500,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">以</text></g><g data-mml-node="mi" transform="translate(18500,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">为</text></g><g data-mml-node="mi" transform="translate(19500,0)"><path data-c="1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(19951,0)"><path data-c="1D452" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g><g data-mml-node="mi" transform="translate(20417,0)"><path data-c="1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g><g data-mml-node="mi" transform="translate(20920,0)"><path data-c="1D45C" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(21405,0)"><path data-c="1D460" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mi" transform="translate(21874,0)"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(22219,0)"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(22580,0)"><path data-c="1D45C" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(23065,0)"><path data-c="1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(23516,0)"><path data-c="1D466" d="M21 287Q21 301 36 335T84 406T158 442Q199 442 224 419T250 355Q248 336 247 334Q247 331 231 288T198 191T182 105Q182 62 196 45T238 27Q261 27 281 38T312 61T339 94Q339 95 344 114T358 173T377 247Q415 397 419 404Q432 431 462 431Q475 431 483 424T494 412T496 403Q496 390 447 193T391 -23Q363 -106 294 -155T156 -205Q111 -205 77 -183T43 -117Q43 -95 50 -80T69 -58T89 -48T106 -45Q150 -45 150 -87Q150 -107 138 -122T115 -142T102 -147L99 -148Q101 -153 118 -160T152 -167H160Q177 -167 186 -165Q219 -156 247 -127T290 -65T313 -9T321 21L315 17Q309 13 296 6T270 -6Q250 -11 231 -11Q185 -11 150 11T104 82Q103 89 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(24006,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">中</text></g><g data-mml-node="mi" transform="translate(25006,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">的</text></g><g data-mml-node="mi" transform="translate(26006,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">每</text></g><g data-mml-node="mi" transform="translate(27006,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">一</text></g><g data-mml-node="mi" transform="translate(28006,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">个</text></g><g data-mml-node="mi" transform="translate(29006,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">函</text></g><g data-mml-node="mi" transform="translate(30006,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">数</text></g><g data-mml-node="mi" transform="translate(31006,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">生</text></g><g data-mml-node="mi" transform="translate(32006,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">成</text></g><g data-mml-node="mi" transform="translate(33006,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">对</text></g><g data-mml-node="mi" transform="translate(34006,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">应</text></g><g data-mml-node="mi" transform="translate(35006,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">的</text></g><g data-mml-node="mi" transform="translate(36006,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">向</text></g><g data-mml-node="mi" transform="translate(37006,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">量</text></g><g data-mml-node="mi" transform="translate(38006,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">表</text></g><g data-mml-node="mi" transform="translate(39006,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">示</text></g></g></g></svg></mjx-container>\theta</em>{f_s}$ 。</p>
<h4 id="Modeling-Assembly-Functions"><a href="#Modeling-Assembly-Functions" class="headerlink" title="Modeling Assembly Functions"></a>Modeling Assembly Functions</h4><p>作者把汇编函数建模成多序列。控制流图的原始线性布局覆盖了无效执行路径。不能直接把他当成训练序列。作者把控制流图当成边覆盖序列和随机 walks。</p>
<h5 id="Selective-Callee-Expansion"><a href="#Selective-Callee-Expansion" class="headerlink" title="Selective Callee Expansion"></a>Selective Callee Expansion</h5><p>使用函数内联，用被调用函数的主体替换了函数调用指令，扩张了汇编函数，并减少了函数调用产生的开销。使用普通的汇编代码训练 Asm2Vec 模型，得到三类 tokens (操作符，操作数，库函数调用)。如果被调用函数长度占调用函数长度的比小于 0.6，或者调用函数小于 10 行指令，则内联该被调用函数。</p>
<h5 id="Edge-Coverage"><a href="#Edge-Coverage" class="headerlink" title="Edge Coverage"></a>Edge Coverage</h5><p>为了生成一个汇编函数的多个序列，从已经内联扩张的控制流程图中随机采样每一条边，直到原始图中的所有边都被覆盖。对于每条采样边，将它们的汇编代码串联起来，形成一个新的序列。这样，可以确保控制流程图被完全覆盖。</p>
<h5 id="Random-Walk"><a href="#Random-Walk" class="headerlink" title="Random Walk"></a>Random Walk</h5><p>除了边采样外，本文还在扩张的 CFG 图上增加随机游走的方式，这样会生成比边采样更长的序列。Dominator 是一个在控制流分析和编译器优化中广泛使用的概念。如果任意基本块 C 必须经过基本块 A 才能到达基本块 B，则基本块 A 相对于基本块 B 占主导地位。经过多次随机游走后，主导块会被多次覆盖，这些主导块可以指示循环结构，也可以指示重要分支条件。通过随机游走找到主导块，可以是我们对该汇编函数有更深刻的认识。</p>
<h4 id="Tranining-Estimating-and-Searching"><a href="#Tranining-Estimating-and-Searching" class="headerlink" title="Tranining, Estimating and Searching"></a>Tranining, Estimating and Searching</h4><p>针对存储库中的每一个汇编函数，采用边采样和随机游走的方式生成序列 (下图 function S)。对于每个序列，其遍历每一条指令并更新 Asm2Vec 模型权重(训练过程)。</p>
<p><img src="https://github.com/lxmliu2002/images/raw/main/post/20240322/image-20240322204751722.png" alt="image-20240322204751722" style="zoom:50%;"></p>
<p>训练完成后，对于一个 query 函数 $f<em>t<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.452ex;" xmlns="http://www.w3.org/2000/svg" width="22.624ex" height="2.149ex" role="img" focusable="false" viewBox="0 -750 10000 950"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">，</text></g><g data-mml-node="mi" transform="translate(1000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">随</text></g><g data-mml-node="mi" transform="translate(2000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">机</text></g><g data-mml-node="mi" transform="translate(3000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">初</text></g><g data-mml-node="mi" transform="translate(4000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">始</text></g><g data-mml-node="mi" transform="translate(5000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">化</text></g><g data-mml-node="mi" transform="translate(6000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">一</text></g><g data-mml-node="mi" transform="translate(7000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">个</text></g><g data-mml-node="mi" transform="translate(8000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">向</text></g><g data-mml-node="mi" transform="translate(9000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">量</text></g></g></g></svg></mjx-container>\theta</em>{f<em>t}<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.452ex;" xmlns="http://www.w3.org/2000/svg" width="127.674ex" height="2.149ex" role="img" focusable="false" viewBox="0 -750 56432 950"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">，</text></g><g data-mml-node="mi" transform="translate(1000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">大</text></g><g data-mml-node="mi" transform="translate(2000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">小</text></g><g data-mml-node="mi" transform="translate(3000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">取</text></g><g data-mml-node="mn" transform="translate(4000,0)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g><g data-mml-node="mi" transform="translate(4500,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">附</text></g><g data-mml-node="mi" transform="translate(5500,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">近</text></g><g data-mml-node="mi" transform="translate(6500,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">的</text></g><g data-mml-node="mi" transform="translate(7500,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">小</text></g><g data-mml-node="mi" transform="translate(8500,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">值</text></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(9500,0)"><g data-mml-node="mo"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">。</text></g></g><g data-mml-node="mi" transform="translate(10500,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">作</text></g><g data-mml-node="mi" transform="translate(11500,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">者</text></g><g data-mml-node="mi" transform="translate(12500,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">选</text></g><g data-mml-node="mi" transform="translate(13500,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">取</text></g><g data-mml-node="mi" transform="translate(14500,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">和</text></g><g data-mml-node="mi" transform="translate(15500,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">训</text></g><g data-mml-node="mi" transform="translate(16500,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">练</text></g><g data-mml-node="mi" transform="translate(17500,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">过</text></g><g data-mml-node="mi" transform="translate(18500,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">程</text></g><g data-mml-node="mi" transform="translate(19500,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">相</text></g><g data-mml-node="mi" transform="translate(20500,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">同</text></g><g data-mml-node="mi" transform="translate(21500,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">的</text></g><g data-mml-node="mi" transform="translate(22500,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">方</text></g><g data-mml-node="mi" transform="translate(23500,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">式</text></g><g data-mml-node="mi" transform="translate(24500,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">，</text></g><g data-mml-node="mi" transform="translate(25500,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">先</text></g><g data-mml-node="mi" transform="translate(26500,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">提</text></g><g data-mml-node="mi" transform="translate(27500,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">取</text></g><g data-mml-node="mi" transform="translate(28500,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">出</text></g><g data-mml-node="mi" transform="translate(29500,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">各</text></g><g data-mml-node="mi" transform="translate(30500,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">个</text></g><g data-mml-node="mi" transform="translate(31500,0)"><path data-c="1D460" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mi" transform="translate(31969,0)"><path data-c="1D452" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g><g data-mml-node="mi" transform="translate(32435,0)"><path data-c="1D45E" d="M33 157Q33 258 109 349T280 441Q340 441 372 389Q373 390 377 395T388 406T404 418Q438 442 450 442Q454 442 457 439T460 434Q460 425 391 149Q320 -135 320 -139Q320 -147 365 -148H390Q396 -156 396 -157T393 -175Q389 -188 383 -194H370Q339 -192 262 -192Q234 -192 211 -192T174 -192T157 -193Q143 -193 143 -185Q143 -182 145 -170Q149 -154 152 -151T172 -148Q220 -148 230 -141Q238 -136 258 -53T279 32Q279 33 272 29Q224 -10 172 -10Q117 -10 75 30T33 157ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path></g><g data-mml-node="mi" transform="translate(32895,0)"><path data-c="1D462" d="M21 287Q21 295 30 318T55 370T99 420T158 442Q204 442 227 417T250 358Q250 340 216 246T182 105Q182 62 196 45T238 27T291 44T328 78L339 95Q341 99 377 247Q407 367 413 387T427 416Q444 431 463 431Q480 431 488 421T496 402L420 84Q419 79 419 68Q419 43 426 35T447 26Q469 29 482 57T512 145Q514 153 532 153Q551 153 551 144Q550 139 549 130T540 98T523 55T498 17T462 -8Q454 -10 438 -10Q372 -10 347 46Q345 45 336 36T318 21T296 6T267 -6T233 -11Q189 -11 155 7Q103 38 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(33467,0)"><path data-c="1D452" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g><g data-mml-node="mi" transform="translate(33933,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(34533,0)"><path data-c="1D450" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g><g data-mml-node="mi" transform="translate(34966,0)"><path data-c="1D452" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g><g data-mml-node="mi" transform="translate(35432,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">，</text></g><g data-mml-node="mi" transform="translate(36432,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">然</text></g><g data-mml-node="mi" transform="translate(37432,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">后</text></g><g data-mml-node="mi" transform="translate(38432,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">依</text></g><g data-mml-node="mi" transform="translate(39432,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">次</text></g><g data-mml-node="mi" transform="translate(40432,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">遍</text></g><g data-mml-node="mi" transform="translate(41432,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">历</text></g><g data-mml-node="mi" transform="translate(42432,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">汇</text></g><g data-mml-node="mi" transform="translate(43432,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">编</text></g><g data-mml-node="mi" transform="translate(44432,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">代</text></g><g data-mml-node="mi" transform="translate(45432,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">码</text></g><g data-mml-node="mi" transform="translate(46432,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">，</text></g><g data-mml-node="mi" transform="translate(47432,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">但</text></g><g data-mml-node="mi" transform="translate(48432,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">是</text></g><g data-mml-node="mi" transform="translate(49432,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">此</text></g><g data-mml-node="mi" transform="translate(50432,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">时</text></g><g data-mml-node="mi" transform="translate(51432,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">固</text></g><g data-mml-node="mi" transform="translate(52432,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">定</text></g><g data-mml-node="mi" transform="translate(53432,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">所</text></g><g data-mml-node="mi" transform="translate(54432,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">有</text></g><g data-mml-node="mi" transform="translate(55432,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">的</text></g></g></g></svg></mjx-container>t<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.452ex;" xmlns="http://www.w3.org/2000/svg" width="2.262ex" height="2.149ex" role="img" focusable="false" viewBox="0 -750 1000 950"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">和</text></g></g></g></svg></mjx-container>t’<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.452ex;" xmlns="http://www.w3.org/2000/svg" width="6.787ex" height="2.149ex" role="img" focusable="false" viewBox="0 -750 3000 950"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">，</text></g><g data-mml-node="mi" transform="translate(1000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">只</text></g><g data-mml-node="mi" transform="translate(2000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">对</text></g></g></g></svg></mjx-container>\theta</em>{f<em>t}<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.452ex;" xmlns="http://www.w3.org/2000/svg" width="31.674ex" height="2.149ex" role="img" focusable="false" viewBox="0 -750 14000 950"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">反</text></g><g data-mml-node="mi" transform="translate(1000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">向</text></g><g data-mml-node="mi" transform="translate(2000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">传</text></g><g data-mml-node="mi" transform="translate(3000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">播</text></g><g data-mml-node="mi" transform="translate(4000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">更</text></g><g data-mml-node="mi" transform="translate(5000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">新</text></g><g data-mml-node="mi" transform="translate(6000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">权</text></g><g data-mml-node="mi" transform="translate(7000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">重</text></g><g data-mml-node="mi" transform="translate(8000,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">，</text></g><g data-mml-node="mi" transform="translate(9000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">最</text></g><g data-mml-node="mi" transform="translate(10000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">终</text></g><g data-mml-node="mi" transform="translate(11000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">得</text></g><g data-mml-node="mi" transform="translate(12000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">到</text></g><g data-mml-node="mi" transform="translate(13000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">的</text></g></g></g></svg></mjx-container>\theta</em>{f_t}$ 的值即为 target function 对应的向量表示。</p>
<p><img src="https://github.com/lxmliu2002/images/raw/main/post/20240322/image-20240322204859718.png" alt="image-20240322204859718" style="zoom:50%;"></p>
<p>最后，target function 对应的向量表示和 repository function 向量表示的余弦相似度，选取相似度高的 top-k，即为结果。</p>
<p>由于存储库中可能有数百万个汇编函数，因此可拓展性对于二进制克隆搜索至关重要。作者只使用成对相似度进行最近邻搜索。低维固定长度向量之间的成对搜索可以很快。</p>
<h3 id="Experiments"><a href="#Experiments" class="headerlink" title="Experiments"></a>Experiments</h3><p>本文将 Asm2Vec 与现有的最先进的动态和静态汇编克隆搜索方法进行比较。有四个实验。首先，作者针对 GCC 的不同编译器优化对基线进行基准测试。其次，作者使用 CLANG 和 OLLVM 评估针对不同重代码混淆的克隆搜索质量。第三，作者使用前两个的所有二进制文件。在最后一个中，作者将 Asm2Vec 应用于公开可用的漏洞搜索数据集。所有二进制文件在克隆搜索之前都被剥离。</p>
<h4 id="Searching-with-Different-Compiler-Optimization-Levels"><a href="#Searching-with-Different-Compiler-Optimization-Levels" class="headerlink" title="Searching with Different Compiler Optimization Levels"></a>Searching with Different Compiler Optimization Levels</h4><p>使用 GCC 编译器版本 5.4.0 对不同优化级别的克隆搜索性能进行了基准测试。基于 10 个广泛使用的效用和数字计算库来评估 Asm2Vec。首先使用具有四种不同的编译器优化设置的 GCC 编译器编译选定的库，从而产生四个不同的二进制文件。然后测试了其中两个的组合，这对应于两个不同的优化级别。给定来自同一库的两个二进制文件，但具有不同的优化级别，使用编译器输出调试符号链接它们的组装函数，并生成函数之间的克隆映射。该映射用作仅用于评估的真实数据。在 RP 和 after 中针对第二个搜索，针对 RP 中的第一个搜索第二个。只有存储库中的二进制用于训练。取两者的平均值。</p>
<p><img src="https://github.com/lxmliu2002/images/raw/main/post/20240322/image-20240322214459101.png" alt="image-20240322214459101" style="zoom:33%;"></p>
<p>Asm2Vec 在最好和更差的情况下都明显优于静态特征。它还优于 BinGo，这是一种最近涉及动态特征的语义克隆搜索方法。这表明 Asm2Vec 对编译器引入的大量语法修改和密集内联具有鲁棒性。它甚至与最先进的语义克隆动态方法 CACompare 实现了具有竞争力的性能。由于样本量小，差异在统计上没有差异。Asm2Vec 在不同的库中表现稳定，能够高精度找到克隆。平均而言，它在检测编译器优化选项 O1、O2 和 O3 之间的克隆方面实现了 93% 以上的精度。随着两个优化级别之间的差异的增加，Asm2Vec 的性能降低。然而，它比其他静态特征不太敏感，这证明了它的鲁棒性。</p>
<h4 id="Searching-with-Code-Obfuscation"><a href="#Searching-with-Code-Obfuscation" class="headerlink" title="Searching with Code Obfuscation"></a>Searching with Code Obfuscation</h4><p>Obfuscator-LLVM (O-LLVM) 建立在 LLVM 框架和 CLANG 编译器工具链之上，在中间语言级别运行，在生成二进制文件之前修改程序的逻辑，增加二进制代码的复杂性。O-LLVM 使用三种不同的技术及其组合：Bogus Control Flow Graph (BCF)、Control Flow Flattening (FLA) 和 Instruction Substitution(SUB)。如图是其统计数据。</p>
<p><img src="https://github.com/lxmliu2002/images/raw/main/post/20240322/image-20240322215826805.png" alt="image-20240322215826805" style="zoom:50%;"></p>
</li>
</ol>
<ul>
<li>BCF 通过添加大量不相关的随机基本块和分支来修改控制流图。它还将拆分、合并和重新排序原始基本块。BCF 打破了 CFG 和基本块完整性。</li>
<li>FLA 使用新条件的复杂层次结构重新组织原始 CFG 作为交换机。原始指令被大量修改以适应新的进入条件和变量。线性布局已被完全修改（平均添加了 376% 的顶点和边）。基于图的特征忽略了这种技术。对于完全覆盖 CFG 的动态方法，它也是不可扩展的。</li>
<li><p>SUB 通过使用预定义的规则对函数逻辑进行一次传递，将汇编代码的片段替换为其等效形式。该技术修改基本块的内容并添加新的常量。SUB 不会改变大部分的图结构。</p>
<p><img src="https://github.com/lxmliu2002/images/raw/main/post/20240322/image-20240322220416814.png" alt="image-20240322220416814" style="zoom: 33%;"></p>
<p>指令替换可以显著提高 n-gram 的性能。SUB 通过在中间添加指令来打破序列。n-perm 的性能优于 n-gram，因为它忽略了标记的顺序。基于图的特征仍然可以恢复超过 60% 的克隆，因为图结构没有被大量修改。Asm2Vec 在汇编指令替换方面可以达到 96% 以上的精度。指令被替换为它们的等价形式，实际上仍然与原始形式具有相似的词汇语义。这些信息被 Asm2Vec 很好地捕获。</p>
<p>在应用 BCF 混淆后，Asm2Vec 仍然可以达到 88% 以上的精度，其中控制流图看起来与原始图非常不同。它表明 Asm2Vec 对插入的 junk 代码和伪造的基本块具有弹性。FLA 混淆破坏了所有子图结构。它们中的大多数的精度值在零附近。即使在这种情况中，Asm2Vec 仍然可以正确匹配 84% 的组装功能克隆。结果表明，Asm2Vec 对子结构变化和线性布局变化具有弹性。在应用所有混淆技术后，Asm2Vec 仍然可以恢复大约 81% 的汇编功能。</p>
<p>Asm2Vec 可以从噪声中正确定位和识别关键模式。插入垃圾基本块或噪声指令遵循随机汇编代码的一般语法，可以通过邻居指令轻松预测。Asm2Vec 中的函数表示捕获了邻居指令无法提供的缺失信息。它还对此信息进行加权，以最好地区分一个函数与另一个函数。</p>
<h4 id="Searching-against-All-Binaries"><a href="#Searching-against-All-Binaries" class="headerlink" title="Searching against All Binaries"></a>Searching against All Binaries</h4><p>在本实验中，使用前两个实验用到的所有二进制文件，评估了藏候选集较大时，Asm2Vec 能够区分不同的汇编函数。作者还使用不同的检索阈值来评估其性能。</p>
<p>作者在不同的 top-k 位置手机召回率和精度。即使使用大量的汇编函数，Asm2Vec 仍然可以在前 20 个结果中达到 70% 的召回率。它显着优于其他传统的基于 tokens 和图形的特征。此外，我们观察到基于 tokens 的方法通常比基于子图的方法表现更好。</p>
<p><img src="https://github.com/lxmliu2002/images/raw/main/post/20240322/image-20240322230106682.png" alt="image-20240322230106682" style="zoom: 33%;"></p>
<p>可见随着 k 的不断变化整体召回率呈上升趋势。观察召回率随 K 值变化曲线和准确率-召回率曲线可见，Asm2vec 模型的效果优势明显。</p>
<h4 id="Searching-Vulnerability-Functions"><a href="#Searching-Vulnerability-Functions" class="headerlink" title="Searching Vulnerability Functions"></a>Searching Vulnerability Functions</h4><p>将 Asm2Vec 实现为开源漏洞搜索引擎，并遵循相同的实验协议，将其性能与最先进的漏洞搜索解决方案进行比较。对于所有漏洞，Asm2Vec 的误报为零，召回率为 100%。因此，它实现了 1 的 ROC 和 CROC。</p>
<p><img src="https://github.com/lxmliu2002/images/raw/main/post/20240322/image-20240322230353068.png" alt="image-20240322230353068" style="zoom:50%;"></p>
<p>JIT: 它转换函数在运行时生成其代码。几乎每条指令都被替换为函数调用。通过设计，静态方法很难恢复任何变体。我们的结果表明，Asm2Vec 仍然能够通过编码文字来恢复 97.2%，使用虚拟化恢复恢复 35%，使用 JIT 执行恢复 45%。我们检查结果并发现 Asm2Vec 试图匹配混淆器忽略的任何相似信息。然而，同时应用三种混淆技术后，Asm2Vec 不再恢复任何克隆。</p>
<p><img src="https://github.com/lxmliu2002/images/raw/main/post/20240322/image-20240322230813840.png" alt="image-20240322230813840" style="zoom:33%;"></p>
</li>
</ul>
<h3 id="Related-Work"><a href="#Related-Work" class="headerlink" title="Related Work"></a>Related Work</h3><h3 id="Limitations-and-Conclusion"><a href="#Limitations-and-Conclusion" class="headerlink" title="Limitations and Conclusion"></a>Limitations and Conclusion</h3><p>  Asm2Vec 有几个限制。首先，它是为单个汇编代码语言设计的，克隆搜索引擎与架构无关。在这个阶段，它并不直接适用于跨架构的语义克隆。未来，我们将通过考虑它们共享的标记（例如常量和 libc 调用）来对齐两种不同组装语言之间的词汇语义空间。其次，当前的选择性调用扩展机制无法确定动态跳转，例如跳转表。第三，作为黑盒静态方法，Asm2Vec 无法通过显示克隆的子图或证明符号等价来解释或证明返回的结果。它的可解释性有限。</p>
<p>  在本文中，我们提出了一种名为 Asm2Vec 的稳健准确的汇编克隆搜索方法，该方法通过将其与其他人区分开来来学习汇编函数的向量表示。Asm2Vec 不需要任何先验知识，例如汇编函数之间的正确映射或使用的编译器优化级别。它学习出现在汇编代码中的标记的词汇语义关系，并将汇编函数表示为潜在语义的内部加权混合。除了汇编函数外，它还可以应用于不同粒度的装配序列，如二进制文件、片段、基本块或函数。我们使用不同的编译器优化选项和混淆技术对汇编代码克隆搜索进行了广泛的实验。我们的结果表明，Asm2Vec 对汇编指令和控制流图的严重变化是准确的和稳健的。</p>
<h2 id="references"><a href="#references" class="headerlink" title="references"></a>references</h2><p>  <a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43846270/article/details/109103725">https://blog.csdn.net/weixin_43846270/article/details/109103725</a></p>
<p>  <a target="_blank" rel="noopener" href="https://www.jianshu.com/p/6cd6fb4ac266">https://www.jianshu.com/p/6cd6fb4ac266</a></p>
<p>  <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/303086691">https://zhuanlan.zhihu.com/p/303086691</a></p>
<p>  <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/191501086">https://zhuanlan.zhihu.com/p/191501086</a></p>
<p>  <a target="_blank" rel="noopener" href="https://nankai.feishu.cn/minutes/obcnal4265y49pfwh4y2qn3i">https://nankai.feishu.cn/minutes/obcnal4265y49pfwh4y2qn3i</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://example.com">Xiuming Liu</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2024/03/22/PaperReading_Asm2Vec/">http://example.com/2024/03/22/PaperReading_Asm2Vec/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">lxmliu2002's blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Binary-Code-Search/">Binary-Code-Search</a><a class="post-meta__tags" href="/tags/Vulnerability-Search/">Vulnerability-Search</a></div><div class="post_share"><div class="social-share" data-image="https://github.com/lxmliu2002/images/raw/main/homepage/home-bg-03.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/03/23/PaperReading_SANN/" title="PaperReading_SANN"><img class="cover" src="https://github.com/lxmliu2002/images/raw/main/homepage/home-bg-03.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">PaperReading_SANN</div></div></a></div><div class="next-post pull-right"><a href="/2024/03/03/CTF_Pwn/" title="CTF_Pwn"><img class="cover" src="https://github.com/lxmliu2002/images/raw/main/homepage/home-bg-ctf.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">CTF_Pwn</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2024/03/23/PaperReading_SANN/" title="PaperReading_SANN"><img class="cover" src="https://github.com/lxmliu2002/images/raw/main/homepage/home-bg-03.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-23</div><div class="title">PaperReading_SANN</div></div></a></div><div><a href="/2024/03/24/PaperReading_jTrans/" title="PaperReading_jTrans"><img class="cover" src="https://github.com/lxmliu2002/images/raw/main/homepage/home-bg-03.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-24</div><div class="title">PaperReading_jTrans</div></div></a></div><div><a href="/2024/03/25/PaperReading_How_Machine_Learning_Is_Solving_the_Binary_Function_Similarity_Problem/" title="PaperReading_How_Machine_Learning_Is_Solving_the_Binary_Function_Similarity_Problem"><img class="cover" src="https://github.com/lxmliu2002/images/raw/main/homepage/home-bg-03.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-25</div><div class="title">PaperReading_How_Machine_Learning_Is_Solving_the_Binary_Function_Similarity_Problem</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://github.com/lxmliu2002/images/raw/main/lxmliu2002.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Xiuming Liu</div><div class="author-info__description">Stay hungry, stay foolish.</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">38</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">12</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">16</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/lxmliu2002"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/lxmliu2002" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:lxmliu2002@gamil.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Asm2Vec-Boosting-Static-Representation-Robustness-for-Binary-Clone-Search-against-Code-Obfuscation-and-Compiler-Optimization"><span class="toc-number">1.</span> <span class="toc-text">Asm2Vec: Boosting Static Representation Robustness for Binary Clone Search against Code Obfuscation and Compiler Optimization</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E8%AF%BB"><span class="toc-number">1.1.</span> <span class="toc-text">通读</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Abstract"><span class="toc-number">1.1.1.</span> <span class="toc-text">Abstract</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Introduction"><span class="toc-number">1.1.2.</span> <span class="toc-text">Introduction</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Problem-Definition"><span class="toc-number">1.1.3.</span> <span class="toc-text">Problem Definition</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Overall-Workflow"><span class="toc-number">1.1.4.</span> <span class="toc-text">Overall Workflow</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Assembly-Code-Representation-Learning"><span class="toc-number">1.1.5.</span> <span class="toc-text">Assembly Code Representation Learning</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Preliminaries"><span class="toc-number">1.1.5.1.</span> <span class="toc-text">Preliminaries</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#The-Asm2Vec-Model"><span class="toc-number">1.1.5.2.</span> <span class="toc-text">The Asm2Vec Model</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Modeling-Assembly-Functions"><span class="toc-number">1.1.5.3.</span> <span class="toc-text">Modeling Assembly Functions</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Selective-Callee-Expansion"><span class="toc-number">1.1.5.3.1.</span> <span class="toc-text">Selective Callee Expansion</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Edge-Coverage"><span class="toc-number">1.1.5.3.2.</span> <span class="toc-text">Edge Coverage</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Random-Walk"><span class="toc-number">1.1.5.3.3.</span> <span class="toc-text">Random Walk</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Tranining-Estimating-and-Searching"><span class="toc-number">1.1.5.4.</span> <span class="toc-text">Tranining, Estimating and Searching</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Experiments"><span class="toc-number">1.1.6.</span> <span class="toc-text">Experiments</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Searching-with-Different-Compiler-Optimization-Levels"><span class="toc-number">1.1.6.1.</span> <span class="toc-text">Searching with Different Compiler Optimization Levels</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Searching-with-Code-Obfuscation"><span class="toc-number">1.1.6.2.</span> <span class="toc-text">Searching with Code Obfuscation</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Searching-against-All-Binaries"><span class="toc-number">1.1.6.3.</span> <span class="toc-text">Searching against All Binaries</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Searching-Vulnerability-Functions"><span class="toc-number">1.1.6.4.</span> <span class="toc-text">Searching Vulnerability Functions</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Related-Work"><span class="toc-number">1.1.7.</span> <span class="toc-text">Related Work</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Limitations-and-Conclusion"><span class="toc-number">1.1.8.</span> <span class="toc-text">Limitations and Conclusion</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#references"><span class="toc-number">1.2.</span> <span class="toc-text">references</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/07/23/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90_d1/" title="数据分析_d1"><img src="https://github.com/lxmliu2002/images/raw/main/homepage/home-bg-secret_flow.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="数据分析_d1"/></a><div class="content"><a class="title" href="/2024/07/23/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90_d1/" title="数据分析_d1">数据分析_d1</a><time datetime="2024-07-22T16:00:00.000Z" title="发表于 2024-07-23 00:00:00">2024-07-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/07/23/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90_d2/" title="数据分析_d2"><img src="https://github.com/lxmliu2002/images/raw/main/homepage/home-bg-secret_flow.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="数据分析_d2"/></a><div class="content"><a class="title" href="/2024/07/23/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90_d2/" title="数据分析_d2">数据分析_d2</a><time datetime="2024-07-22T16:00:00.000Z" title="发表于 2024-07-23 00:00:00">2024-07-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/07/23/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90_d3/" title="数据分析_d3"><img src="https://github.com/lxmliu2002/images/raw/main/homepage/home-bg-secret_flow.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="数据分析_d3"/></a><div class="content"><a class="title" href="/2024/07/23/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90_d3/" title="数据分析_d3">数据分析_d3</a><time datetime="2024-07-22T16:00:00.000Z" title="发表于 2024-07-23 00:00:00">2024-07-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/07/23/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90_d4/" title="数据分析_d4"><img src="https://github.com/lxmliu2002/images/raw/main/homepage/home-bg-secret_flow.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="数据分析_d4"/></a><div class="content"><a class="title" href="/2024/07/23/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90_d4/" title="数据分析_d4">数据分析_d4</a><time datetime="2024-07-22T16:00:00.000Z" title="发表于 2024-07-23 00:00:00">2024-07-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/07/23/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0_d1/" title="机器学习_d1"><img src="https://github.com/lxmliu2002/images/raw/main/homepage/home-bg-secret_flow.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="机器学习_d1"/></a><div class="content"><a class="title" href="/2024/07/23/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0_d1/" title="机器学习_d1">机器学习_d1</a><time datetime="2024-07-22T16:00:00.000Z" title="发表于 2024-07-23 00:00:00">2024-07-23</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://github.com/lxmliu2002/images/raw/main/homepage/home-bg-03.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2024 By Xiuming Liu</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="/js/tw_cn.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu@4.0.7/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, '']
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script></div><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/canvas-fluttering-ribbon.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=4.13.0"></script></div></div><!-- hexo injector body_end start --><script data-pjax>
  function butterfly_clock_anzhiyu_injector_config(){
    var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
    var item_html = '<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img class="entered loading" id="card-clock-loading" src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading"/></div></div></div></div></div>';
    console.log('已挂载butterfly_clock_anzhiyu')
    if(parent_div_git) {
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var qweather_key = 'b16a1fa0e63c46a4b8f28abfb06ae3fe';
  var gaud_map_key = 'e2b04289e870b005374ee030148d64fd&s=rsv3';
  var baidu_ak_key = 'undefined';
  var flag = 0;
  var clock_rectangle = '112.982279,28.19409';
  var clock_default_rectangle_enable = 'false';

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_clock_anzhiyu_injector_config();
  }
  else if (epage === cpage){
    butterfly_clock_anzhiyu_injector_config();
  }
  </script><script src="https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"></script><script data-pjax src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/clock.min.js"></script><!-- hexo injector body_end end --></body></html>